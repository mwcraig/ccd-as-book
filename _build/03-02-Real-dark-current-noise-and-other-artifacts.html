---
redirect_from:
  - "03-02-real-dark-current-noise-and-other-artifacts"
interact_link: content/03-02-Real-dark-current-noise-and-other-artifacts.ipynb
kernel_name: python3
has_widgets: false
title: |-
  Real dark current: noise and other artifacts
prev_page:
  url: /03-01-Dark-current-The-ideal-case.html
  title: |-
    Dark current: the ideal case
next_page:
  url: /03-04-Handling-overscan-and-bias-for-dark-frames.html
  title: |-
    Handling overscan and bias for dark frames
suffix: .ipynb

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---

    <main class="jupyter-page">
    
<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Real-dark-current:-noise-and-other-artifacts">Real dark current: noise and other artifacts<a class="anchor-link" href="#Real-dark-current:-noise-and-other-artifacts"> </a></h1>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The dark current on modern CCDs, even relatively inexpensive ones, is very
small. In a typical exposure the dark current is likely smaller, maybe much
smaller, than the read noise. Despite that, it is worth examining some dark
frames from your camera. because not all pixels have the same dark current.
Some, called hot pixels, have much higher dark current than the rest of the
sensor. Some sensors have non-astronomical sources of counts whose value are
proportional to exposure time, like dark current, but whose origin is nonthermal
effects.</p>
<p>As we did in the <a href="01-08-Overscan.html">notebook about overscan</a>, we will focus on a pair of
cameras to illustrate this point and demonstrate how to take similar images with
your camera and analyze them.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="k">import</span> <span class="n">CCDData</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="k">import</span> <span class="n">hist</span>

<span class="kn">from</span> <span class="nn">convenience_functions</span> <span class="k">import</span> <span class="n">show_image</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Use custom style for larger fonts and figures</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;guide.mplstyle&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Making-an-image-to-check-for-hot-pixels">Making an image to check for hot pixels<a class="anchor-link" href="#Making-an-image-to-check-for-hot-pixels"> </a></h2><p><a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/pull/207/files#diff-d3fab14ddf68a649876b585d268b34efR59" target="_blank"><em>Click here to comment on this section on GitHub (opens in new tab).</em></a></p>
<p>Measuring the dark current in a camera requires taking images with fairly long
exposure time, ideally long enough that the expected counts due to dark current
is larger than the expected noise in the image. If that isn't the case then the
dark images will be measuring noise, not dark current, as we saw in the
<a href="03.01-Dark-current-The-ideal-case">previous section</a>.</p>
<p>There are two ways to ensure that you are measuring dark current:</p>
<ul>
<li>Take some long-exposure dark frames. The exposure time should be long enough
that the expected dark counts is at least as large as the noise expected in a
single image.</li>
<li>Take several of these images and combine them to reduce the noise in the
result. The noise in the combined image is proportional to $1/\sqrt{N}$, where
$N$ is the number of images that are combined.</li>
</ul>
<h3 id="What-if-that-isn't-possible?">What if that isn't possible?<a class="anchor-link" href="#What-if-that-isn't-possible?"> </a></h3><p><a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/pull/207/files#diff-d3fab14ddf68a649876b585d268b34efR77" target="_blank"><em>Click here to comment on this section on GitHub (opens in new tab).</em></a></p>
<p>Do your best. The darks from the Large Format Camera were take as part of a
science run in which there was limited time for taking dark frames. The key
thing to keep in mind is the lower limit on the dark current you can measure
given the read noise and exposure time.</p>
<p>The darks in Case 2 were taken with a new camera that was not yet mounted on the
telescope as part of commissioning the camera. That made taking over 5 hours of
dark frames more feasible!</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Case-1:-Cryogenically-cooled--Large-Format-Camera-(LFC)-at-Palomar">Case 1: Cryogenically cooled  Large Format Camera (LFC) at Palomar<a class="anchor-link" href="#Case-1:-Cryogenically-cooled--Large-Format-Camera-(LFC)-at-Palomar"> </a></h2><p><a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/pull/207/files#diff-d3fab14ddf68a649876b585d268b34efR93" target="_blank"><em>Click here to comment on this section on GitHub (opens in new tab).</em></a></p>
<p>The images in this section are from chip 0 of the LFC at the Palomar 200-inch
telescope. Technical information about the camera is
<a href="http://www.astro.caltech.edu/palomar/observer/200inchResources/lfcspecs.html">here</a>. The technical information says nothing about
the expected dark current of this camera. The expectation for cameras cooled by
liquid nitrogen is that their dark current is essentially zero.</p>
<p>What we will see with this camera is that</p>
<ul>
<li>not all of the pixels have negligible dark current, and</li>
<li>not all of the counts in a dark image are from dark current.</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Estimating-exposure-time-and-number-of-frames-for-measuring-dark-current">Estimating exposure time and number of frames for measuring dark current<a class="anchor-link" href="#Estimating-exposure-time-and-number-of-frames-for-measuring-dark-current"> </a></h3><p><a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/pull/207/files#diff-d3fab14ddf68a649876b585d268b34efR112" target="_blank"><em>Click here to comment on this section on GitHub (opens in new tab).</em></a></p>
<p>Unfortunately, the technical information for this camera does not include any
information about the expected dark current. For thermoelectrically-cooled
cameras the dark current is no more than 0.1 $e^-$/sec/pixel, and for newer
camers is more like 0.01$e^-$/sec/pixel. We will assume the smaller dark current
here.</p>
<p>The read noise for this camera is 11$e^-$/pixel, so the exposure time needed to
just reach the case where the dark counts is equal to the read noise is</p>
$$
t_\text{dark, min} = \frac{11 e^-/\text{pixel}}{0.01 e^-/\text{sec/pixel}} = 1100~\text{sec}.
$$<p>Even that leaves us with an image that dominated by read noise rather than dark
current. Combining 100 of those images would reduce the read noise by a factor
of 10, which would be ideal for precisely measuring the dark current in each
pixel. Unfortunately, taking over 30 hours of dark images is not feasible.</p>
<p>Instead, we will work with what we have for this camera: three dark images, each
300 seconds. This places a lower limit on the dark current we can measure -- we
will only be able to measure the dark current for fairly "hot" pixels -- but it
at least gives us some idea of the dark properties of the camera.</p>
<p>Another way to phrase this is much more positive: for most of the pixels in the
image the dark current simply does not matter because it is completely swamped
by the read noise.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First, we read in the image.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">calibrated_images</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">combined_dark_lfc</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">calibrated_images</span> <span class="o">/</span> <span class="s1">&#39;combined_dark_300.000.fits.bz2&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Examine-the-image">Examine the image<a class="anchor-link" href="#Examine-the-image"> </a></h3><p><a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/pull/207/files#diff-d3fab14ddf68a649876b585d268b34efR163" target="_blank"><em>Click here to comment on this section on GitHub (opens in new tab).</em></a></p>
<p>The full image is on the left, and the lower left corner is shown on the right.
The light area in the lower left corner is due to sensor glow, which is light
emitted by the electronics of the CCD. The counts in the image due to sensor
glow should grow linearly with exposure time, like dark counts do, but the pixel
values are much higher than for pixels whose counts are due to dark current.</p>
<p>The top right panel in the figure below shows the part of the CCD near the
sensor glow; pixel values are several thousand counts. The bottom right panel
shows a portion of the CCD in the upper right part of the chip; pixel values are
<em>much</em> lower, typically under 10.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">whole_im_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">glow_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">dark_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>

<span class="n">show_image</span><span class="p">(</span><span class="n">combined_dark_lfc</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">whole_im_ax</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">whole_im_ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Entire chip&#39;</span><span class="p">)</span>

<span class="n">show_image</span><span class="p">(</span><span class="n">combined_dark_lfc</span><span class="p">[:</span><span class="mi">200</span><span class="p">,</span> <span class="p">:</span><span class="mi">200</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">glow_ax</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">glow_ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Lower left corner of chip&#39;</span><span class="p">)</span>

<span class="n">show_image</span><span class="p">(</span><span class="n">combined_dark_lfc</span><span class="p">[</span><span class="o">-</span><span class="mi">200</span><span class="p">:,</span> <span class="o">-</span><span class="mi">200</span><span class="p">:],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">dark_ax</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">dark_ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Upper right corner of chip&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>WARNING: The following attributes were set on the data object, but will be ignored by the function: meta, unit [astropy.nddata.decorators]
WARNING: The following attributes were set on the data object, but will be ignored by the function: meta, unit [astropy.nddata.decorators]
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/03-02-Real-dark-current-noise-and-other-artifacts_10_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dark-current-in-this-CCD">Dark current in this CCD<a class="anchor-link" href="#Dark-current-in-this-CCD"> </a></h3><p><a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/pull/207/files#diff-d3fab14ddf68a649876b585d268b34efR204" target="_blank"><em>Click here to comment on this section on GitHub (opens in new tab).</em></a></p>
<p>The histogram below shows dark current along the horizontal axis and the number
of pixels in the CCD with that dark current along the vertical axis. Since there
is obvious sensor glow in the darks three distributions are shown:</p>
<ul>
<li>The full sensor, which at first glance has some pixels with dark current as
high as 10 $e^-$/sec.</li>
<li>The portion of the sensor <em>excluding</em> the sensor glow, in which the dark
current is, as expected, low, though there is a small fraction of "hot pixels"
with dark current around 1 $e^-$/sec.</li>
<li>The sensor glow region. That region is apparent in the clump of pixels with
equivalent dark current of 0.5$e^-$/sec and higher.</li>
</ul>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gain</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">exposure_time</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">dark_current_ln2</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">*</span> <span class="n">combined_dark_lfc</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">exposure_time</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">hist</span><span class="p">(</span><span class="n">dark_current_ln2</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span>
     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Full sensor&#39;</span><span class="p">);</span>
<span class="n">hist</span><span class="p">(</span><span class="n">dark_current_ln2</span><span class="p">[</span><span class="mi">200</span><span class="p">:,</span> <span class="mi">200</span><span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sensor, excluding sensor glow region&#39;</span><span class="p">)</span>
<span class="n">hist</span><span class="p">(</span><span class="n">dark_current_ln2</span><span class="p">[:</span><span class="mi">200</span><span class="p">,</span> <span class="p">:</span><span class="mi">200</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C9&#39;</span><span class="p">,</span>
     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sensor glow region only&#39;</span><span class="p">);</span>
<span class="c1">#plt.semilogy()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">noise_limit</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">11</span><span class="o">/</span><span class="n">exposure_time</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">11</span><span class="o">/</span><span class="n">exposure_time</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">8e6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">8e6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">)</span>
<span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()</span>
<span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
<span class="n">noisy_region</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">),</span> <span class="n">noise_limit</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Noise-dominated region&#39;</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">noisy_region</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;dark current, electrons per second&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of pixels with that dark current&#39;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/03-02-Real-dark-current-noise-and-other-artifacts_12_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Case-2:-Thermo-electrically-cooled-camera">Case 2: Thermo-electrically cooled camera<a class="anchor-link" href="#Case-2:-Thermo-electrically-cooled-camera"> </a></h2>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Taking-an-image-to-measure-dark-current">Taking an image to measure dark current<a class="anchor-link" href="#Taking-an-image-to-measure-dark-current"> </a></h3>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The image below is a combination of 20 dark frames, each a 1000 sec exposure.
That exposure time was chosen so that the expected number of dark electrons was
at least somewhat larger than the read noise expected in a combination of 20
images. As we saw in the previous notebook, unless that is the case the dark
frames will measure read noise instead of dark current.</p>
<p>This camera has a dark current of $0.01 e^-$/sec/pixel and read noise of roughly
$10 e^-$/read/pixel/, so the exposure time at which the dark current is as large
as the read noise is</p>
$$
t_\text{dark, min} = \frac{10 e^-/\text{pixel}}{0.01 e^-/\text{sec/pixel}} = 1000~\text{sec}.
$$<p>By combining 20 of the images, the expected noise in the combination is reduced
by a factor of $\sqrt{20}$ to $2.2 e^-$/pixel. This puts us in the "low read
noise" limit in the previous notebook about ideal dark current.</p>
<p>Measuring the dark current once you have the images is relatively
straightforward: subtract the bias, multiply the result by the gain and then
divide by the exposure time to obtain the dark current in $e^-$/pixel/sec.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dark_1000</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;master_dark_exposure_1000.0.fit.bz2&#39;</span><span class="p">)</span>
<span class="n">show_image</span><span class="p">(</span><span class="n">dark_1000</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>WARNING: The following attributes were set on the data object, but will be ignored by the function: meta, unit [astropy.nddata.decorators]
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/03-02-Real-dark-current-noise-and-other-artifacts_16_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculate-the-dark-current-for-each-pixel">Calculate the dark current for each pixel<a class="anchor-link" href="#Calculate-the-dark-current-for-each-pixel"> </a></h3><p><a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/pull/207/files#diff-d3fab14ddf68a649876b585d268b34efR311" target="_blank"><em>Click here to comment on this section on GitHub (opens in new tab).</em></a></p>
<p>Recall that the dark current $d_c(T)$ is given by</p>
$$
d_c(T) = d_e(t) / t,
$$<p>where $d_e(t)$ is the number of dark electrons in the images. That is related to
the dark counts, $n_{dark}(t)$, the image values displayed in the image above,
by the gain of the camera, $d_e(t) = g n_{dark}(t)$, so that</p>
$$
d_C(T) = g n_{dark}(t) / t.
$$<p>This particular camera has a gain of $g = 1.5 e^-$/ADU.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gain</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">read_noise</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">exposure_time</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">dark_current</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">*</span> <span class="n">dark_1000</span><span class="o">.</span><span class="n">data</span> <span class="o">/</span> <span class="n">exposure_time</span>

<span class="n">noisy_region</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">read_noise</span> <span class="o">/</span> <span class="n">exposure_time</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">hist</span><span class="p">(</span><span class="n">dark_current</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Dark current&#39;</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">4e7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">noisy_region</span><span class="p">,</span> <span class="o">*</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>


<span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()</span>
<span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
<span class="n">noisy_region</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">),</span> <span class="n">noisy_region</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Noise-dominated region&#39;</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">noisy_region</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;dark current, electrons per second&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of pixels with that dark current&#39;</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/03-02-Real-dark-current-noise-and-other-artifacts_18_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="There-is-a-large-range-in-the-dark-current">There is a large range in the dark current<a class="anchor-link" href="#There-is-a-large-range-in-the-dark-current"> </a></h3><p><a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/pull/207/files#diff-d3fab14ddf68a649876b585d268b34efR371" target="_blank"><em>Click here to comment on this section on GitHub (opens in new tab).</em></a></p>
<p>While the vast majority of the pixels do, as expected, have very low dark
current, it is much higher for other pixels. These pixels, called hot pixels,
can occur even in cryogenically-cooled cameras.</p>
<p>The vast majority of the pixels in the image have a dark current around the
value promised by the manufacturer, 0.01 $e^-$/sec; the highest nominally have
dark current 98 $e^-$/sec.</p>
<p>However, there is  an upper limit to the dark current that can be measured in a
particular exposure because the CCD saturates once the counts become large
enough. In other words, there is an upper limit to the number of counts a CCD
can represent; for this camera the limit is $2^{16} -1$, or $65,563$ counts. If
we convert that to a dark current for a 1000 sec exposure, it is approximately</p>
$$
\text{dark current for saturated pixel} =  \text{gain} \times \frac{\text{saturation counts}}{\text{exposure time}} =  1.5 \frac{e^-}{\text{count}}\frac{65,563~\text{count}}{1000 \text{sec}} = 98 \frac{e^-}{\text{sec}}.
$$<p>For the hottest pixels in this image, that is the <em>lower limit</em> of the dark
current for those pixels.</p>
<p>The dark current is also not well estimated for pixels a bit below the maximum
because CCDs stop responding linearly once they pass a pixel value that depends
on the camera. For this camera, the linearity limit is around 55,000 counts,
corresponding to a dark current of roughly  82 $e^-$/sec.</p>
<p>One can, in principle, also check whether the hot pixels have a constant dark
current that does not change with time by creating a number of these darks at
different exposure times and plotting the dark current as a function of exposure
time for the hot pixels. If the dark current is constant then the dark counts
will be properly removed when the dark is subtracted from the science image. If
the dark current is not constant, the pixel should be excluded from analysis.</p>
<p>The fraction of very hot pixels, those above 1 $e^-$/sec, is relatively small,
roughly 0.1% of the pixels.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">hist</span><span class="p">(</span><span class="n">dark_current_ln2</span><span class="p">[</span><span class="mi">200</span><span class="p">:,</span> <span class="mi">200</span><span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cryogenically cooled, excluding sensor glow&#39;</span><span class="p">);</span>
<span class="n">hist</span><span class="p">(</span><span class="n">dark_current</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Thermo-electrically cooled&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;dark current, electrons per second&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of pixels with that dark current&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="images/03-02-Real-dark-current-noise-and-other-artifacts_20_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-handle-hot-pixels">How to handle hot pixels<a class="anchor-link" href="#How-to-handle-hot-pixels"> </a></h2><p><a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/pull/207/files#diff-d3fab14ddf68a649876b585d268b34efR430" target="_blank"><em>Click here to comment on this section on GitHub (opens in new tab).</em></a></p>
<p>There are a few ways one could handle this, which can be used in combination
with each other:</p>
<ul>
<li>Mark all pixels above some threshold as bad and create a mask to keep track of
these bad pixels.</li>
<li>Mark only the really high dark current pixels as bad and mask them; for the
rest, subtract dark current as usual.</li>
<li>Always take dark images with exposure times that match your flat and light
frames and subtract dark current as usual.</li>
<li>Take one set of darks with exposure equal to the <em>longest</em> exposure time in
your flat and light images and scale the dark current downwards to match your
other exposure times.</li>
</ul>
<h2 id="One-thing-NOT-to-do">One thing NOT to do<a class="anchor-link" href="#One-thing-NOT-to-do"> </a></h2><p><a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/pull/207/files#diff-d3fab14ddf68a649876b585d268b34efR445" target="_blank"><em>Click here to comment on this section on GitHub (opens in new tab).</em></a></p>
<p>Do not take short dark frames and scale them up to longer exposure times. Modern
cameras, even thermo-electrically cooled ones, have very low dark current. If
your dark frames have low exposure time then most of the pixels are measuring
read noise, not dark current. If you rescale those images to a longer exposure
time then you inappropriately amplify that noise. Ideally, the expected dark
counts (or dark electrons) in your dark frames should be at least a few times
larger than the expected read noise in the frames you combine to make a
reference dark.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Summary">Summary<a class="anchor-link" href="#Summary"> </a></h2><p><a href="https://github.com/astropy/ccd-reduction-and-photometry-guide/pull/207/files#diff-d3fab14ddf68a649876b585d268b34efR461" target="_blank"><em>Click here to comment on this section on GitHub (opens in new tab).</em></a></p>
<ol>
<li>A dark frame only measures dark current if the expected dark counts exceed
the read noise of the camera by a factor of a few.</li>
<li>Take multiple dark frames and combine them to reduce the noise level in the
combined image as much as possible.</li>
<li>Most pixels in a CCD have very low dark current.</li>
<li>A consequence of 1 and 3 is that you should almost never scale your dark
frames up to a longer exposure time because you will amplify noise instead of
eliminating dark current, even if you have combined multiple images as in 2.</li>
<li>Identify hot pixels and mask them out or otherwise deal with them.</li>
</ol>

</div>
</div>
</div>
</div>

 


    </main>
    
