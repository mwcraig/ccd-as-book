<!DOCTYPE html>
<html lang="en">
  

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>Calibrating bias images</title>
  <meta name="description" content="Calibrating bias images">

  <link rel="canonical" href="/YOUR%20URL//02-01-Calibrating-bias-images.html">
  <link rel="alternate" type="application/rss+xml" title="CCD Data Reduction Guide" href="/YOUR%20URL//feed.xml">

  <meta property="og:url"         content="/YOUR%20URL//02-01-Calibrating-bias-images.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Calibrating bias images" />
<meta property="og:description" content="Calibrating bias images" />
<meta property="og:image"       content="" />


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage":
    "YOUR URL//02-01-Calibrating-bias-images.html",
  "headline":
    "Calibrating bias images",
  "datePublished":
    "2019-05-29T18:21:05-05:00",
  "dateModified":
    "2019-05-29T18:21:05-05:00",
  "description":
    "Calibrating bias images",
  "author": {
    "@type": "Person",
    "name": "Matthew Craig"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "YOUR URL/",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "YOUR URL/",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css ">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/images/logo/favicon.ico">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    CommonHTML: {
        linebreaks: {
            automatic: true,
        },
    },
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_CHTML' async></script>

  <!-- DOM updating function -->
  <script>
const runWhenDOMLoaded = cb => {
  if (document.readyState != 'loading') {
    cb()
  } else if (document.addEventListener) {
    document.addEventListener('DOMContentLoaded', cb)
  } else {
    document.attachEvent('onreadystatechange', function() {
      if (document.readyState == 'complete') cb()
    })
  }
}

// Helper function to init things quickly
initFunction = function(myfunc) {
  runWhenDOMLoaded(myfunc);
  document.addEventListener('turbolinks:load', myfunc);
};
</script>

  <!-- Define some javascript variables that will be useful in other javascript -->
  <script>
    const site_basename = '/';
  </script>

  <!-- Add AnchorJS to let headers be linked -->
  <script src="/assets/js/anchor.min.js"  type="text/javascript"></script>
  <script>

initFunction(function () {
    anchors.add("main h1, main h2, main h3, main h4")
});

</script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="/assets/js/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  <script src="https://unpkg.com/nbinteract-core" async></script>

  <!-- Load Thebelab for interactive widgets -->
  <!-- Include Thebelab for interactive code if it's enabled -->


  <!-- Google analytics -->
  <script src="/assets/js/ga.js" async></script>

  <!-- Clipboard copy button -->
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" async></script>

  <!-- Load JS that depends on site variables -->
  <script>
/**
 * Set up copy/paste for code blocks
 */
const codeCellId = index => `codecell${index}`

const clipboardButton = id =>
  `<a class="btn copybtn o-tooltip--left" data-tooltip="Copy" data-clipboard-target="#${id}">
    <img src="/assets/images/copy-button.svg" alt="Copy to clipboard">
  </a>`

// Clears selected text since ClipboardJS will select the text when copying
const clearSelection = () => {
  if (window.getSelection) {
    window.getSelection().removeAllRanges()
  } else if (document.selection) {
    document.selection.empty()
  }
}

// Changes tooltip text for two seconds, then changes it back
const temporarilyChangeTooltip = (el, newText) => {
  const oldText = el.getAttribute('data-tooltip')
  el.setAttribute('data-tooltip', newText)
  setTimeout(() => el.setAttribute('data-tooltip', oldText), 2000)
}

const addCopyButtonToCodeCells = () => {
  // If ClipboardJS hasn't loaded, wait a bit and try again. This
  // happens because we load ClipboardJS asynchronously.
  if (window.ClipboardJS === undefined) {
    setTimeout(addCopyButtonToCodeCells, 250)
    return
  }

  const codeCells = document.querySelectorAll('div.highlighter-rouge:not(.output) pre')
  codeCells.forEach((codeCell, index) => {
    const id = codeCellId(index)
    codeCell.setAttribute('id', id)
    if (document.querySelector(`pre#${id} + a`) == null) {
      codeCell.insertAdjacentHTML('afterend', clipboardButton(id));
    }
  })

  const clipboard = new ClipboardJS('.copybtn')
  clipboard.on('success', event => {
    clearSelection()
    temporarilyChangeTooltip(event.trigger, 'Copied!')
  })

  clipboard.on('error', event => {
    temporarilyChangeTooltip(event.trigger, 'Failed to copy')
  })

  // Get rid of clipboard before the next page visit to avoid memory leak
  document.addEventListener('turbolinks:before-visit', () =>
    clipboard.destroy()
  )
}

initFunction(addCopyButtonToCodeCells);
</script>

  <!-- Hide cell code -->
  
<script>
/**
Add buttons to hide code cells
*/


var setCodeCellVisibility = function(inputField, kind) {
    // Update the image and class for hidden
    var id = inputField.getAttribute('data-id');
    var codeCell = document.querySelector(`#${id}`);

    if (kind === "visible") {
        codeCell.classList.remove('hidden');
        inputField.checked = true;
    } else {
        codeCell.classList.add('hidden');
        inputField.checked = false;
    }
}

var toggleCodeCellVisibility = function (event) {
    // The label is clicked, and now we decide what to do based on the input field's clicked status
    if (event.target.tagName === "LABEL") {
        var inputField = event.target.previousElementSibling;
    } else {
        // It is the span inside the target
        var inputField = event.target.parentElement.previousElementSibling;
    }

    if (inputField.checked === true) {
        setCodeCellVisibility(inputField, "visible");
    } else {
        setCodeCellVisibility(inputField, "hidden");
    }
}


// Button constructor
const hideCodeButton = id => `<input class="hidebtn" type="checkbox" id="hidebtn${id}" data-id="${id}"><label title="Toggle cell" for="hidebtn${id}" class="plusminus"><span class="pm_h"></span><span class="pm_v"></span></label>`

var addHideButton = function () {
  // If a hide button is already added, don't add another
  if (document.querySelector('div.hidecode input') !== null) {
      return;
  }

  // Find the input cells and add a hide button
  document.querySelectorAll('div.input_area div.highlight').forEach(function (item, index) {
    if (!item.parentElement.classList.contains("hidecode")) {
        // Skip the cell if it doesn't have a hidecode class
        return;
    }

    const id = codeCellId(index)
    item.setAttribute('id', id);
    item.insertAdjacentHTML('afterend', hideCodeButton(id))

    // Set up the visibility toggle
    hideLink = document.querySelector(`#${id} + input + label`);
    hideLink.addEventListener('click', toggleCodeCellVisibility)
  });
}


// Initialize the hide buttos
var initHiddenCells = function () {
    // Add hide buttons to the cells
    addHideButton();

    // Toggle the code cells that should be hidden
    document.querySelectorAll('div.hidecode input').forEach(function (item) {
        setCodeCellVisibility(item, 'hidden');
        item.checked = true;
    })
}

initFunction(initHiddenCells);

</script>


  <!-- Load custom website scripts -->
  <script src="/assets/js/scripts.js" async></script>

  <!-- Load custom user CSS and JS  -->
  <script src="/assets/custom/custom.js" async></script>
  <link rel="stylesheet" href="/assets/custom/custom.css">

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  

  <!-- Lunr search code - will only be executed on the /search page -->
  <script src="/assets/js/lunr/lunr.min.js" type="text/javascript"></script>
  <script>var initQuery = function() {
  // See if we have a search box
  var searchInput = document.querySelector('input#lunr_search');
  if (searchInput === null) {
    return;
  }

  // Function to parse our lunr cache
  var idx = lunr(function () {
    this.field('title')
    this.field('excerpt')
    this.field('categories')
    this.field('tags')
    this.ref('id')

    this.pipeline.remove(lunr.trimmer)

    for (var item in store) {
      this.add({
        title: store[item].title,
        excerpt: store[item].excerpt,
        categories: store[item].categories,
        tags: store[item].tags,
        id: item
      })
    }
  });

  // Run search upon keyup
  searchInput.addEventListener('keyup', function () {
    var resultdiv = document.querySelector('#results');
    var query = document.querySelector("input#lunr_search").value.toLowerCase();
    var result =
      idx.query(function (q) {
        query.split(lunr.tokenizer.separator).forEach(function (term) {
          q.term(term, { boost: 100 })
          if(query.lastIndexOf(" ") != query.length-1){
            q.term(term, {  usePipeline: false, wildcard: lunr.Query.wildcard.TRAILING, boost: 10 })
          }
          if (term != ""){
            q.term(term, {  usePipeline: false, editDistance: 1, boost: 1 })
          }
        })
      });

      // Empty the results div
      while (resultdiv.firstChild) {
        resultdiv.removeChild(resultdiv.firstChild);
      }

    resultdiv.insertAdjacentHTML('afterbegin', '<p class="results__found">'+result.length+' Result(s) found</p>');
    for (var item in result) {
      var ref = result[item].ref;
      if(store[ref].teaser){
        var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<div class="archive__item-teaser">'+
                '<img src="'+store[ref].teaser+'" alt="">'+
              '</div>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      else{
    	  var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      resultdiv.insertAdjacentHTML('beforeend', searchitem);
    }
  });
};

initFunction(initQuery);
</script>
</head>

  <body>
    <!-- .js-show-sidebar shows sidebar by default -->
    <div id="js-textbook" class="c-textbook js-show-sidebar">
      



<nav id="js-sidebar" class="c-textbook__sidebar">
  <a href="https://jupyter.org/jupyter-book/"><img src="/images/logo/logo.png" class="textbook_logo" id="sidebar-logo" data-turbolinks-permanent/></a>
  <h2 class="c-sidebar__title">CCD Data Reduction Guide</h2>
  <ul class="c-sidebar__chapters">
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/00-00-Preface.html"
        >
          
          Home
        </a>

        
      </li>

      
    
      
      
        <li class="c-sidebar__chapter"><a class="c-sidebar__entry" href="/search.html">Search</a></li>
        
      
      
        <li class="c-sidebar__divider"></li>
        
      
      
        <li><h2 class="c-sidebar__title">CCD Data Reduction Guide</li>
        
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/01-00-Understanding-an-astronomical-CCD-image.html"
        >
          
            1.
          
          Understanding astronomical images
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/01-03-Construction-of-an-artificial-but-realistic-image.html"
                >
                  
                    1.1
                  
                  An artificial, but realistic, image
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/01-04-Nonuniform-sensitivity.html"
                >
                  
                    1.2
                  
                  Non-uniform sensitivity in astronomical detectors
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/01-05-Calibration-overview.html"
                >
                  
                    1.3
                  
                  Calibration overview
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/01-06-Image-combination.html"
                >
                  
                    1.4
                  
                  Image combination
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/01-07-Calibration-choices-you-need-to-make.html"
                >
                  
                    1.5
                  
                  Calibration choices to make
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/01-08-Overscan.html"
                >
                  
                    1.6
                  
                  Overscan
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/01-09-reading-images.html"
                >
                  
                    1.7
                  
                  Reading images
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/02-00-Handling-overscan-trimming-and-bias-subtraction.html"
        >
          
            2.
          
          Overscan and bias images
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry c-sidebar__entry--active"
                  href="/02-01-Calibrating-bias-images.html"
                >
                  
                    2.1
                  
                  Calibrating bias images
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/02-04-Combine-bias-images-to-make-master.html"
                >
                  
                    2.2
                  
                  Combinge bias images to make master bias
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/03-00-Dark-current-and-hot-pixels.html"
        >
          
            3.
          
          Dark current and dark frames
        </a>

        

          
          
          
          

          

          <ul class="c-sidebar__sections ">
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/03-01-Dark-current-The-ideal-case.html"
                >
                  
                    3.1
                  
                  Dark current: the ideal case
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/03-02-Reality-of-dark-currrent--most-of-your-dark-frame-is-noise-and-not-all-of-the-time-dependent-artifacts-are-dark-current.html"
                >
                  
                    3.2
                  
                  Reality: most of your dark frame is noise and not all of the time dependent artifacts are dark current
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/03-04-Make-a-choice-about-next-steps-for-darks.html"
                >
                  
                    3.3
                  
                  Make a choice about next steps for darks
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/03-05-Calibrate-dark-images.html"
                >
                  
                    3.4
                  
                  Calibrate dark images
                </a>

                
                

              </li>
              
            
              
              

              <li class="c-sidebar__section">
                <a class="c-sidebar__entry "
                  href="/03-06-Combine-darks-for-use-in-later-calibration-steps.html"
                >
                  
                    3.5
                  
                  Combine calibrated dark images for use in later reduction steps
                </a>

                
                

              </li>
              
            
          </ul>
        
      </li>

      
    
      
      
        <li class="c-sidebar__divider"></li>
        
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="https://github.com/mwcraig/ccd-reduction-and-photometry-guide"
        >
          
          GitHub repository
        </a>

        
      </li>

      
    
  </ul>
  <p class="sidebar_footer">Powered by <a href="https://github.com/jupyter/jupyter-book">Jupyter Book</a> and <a href="https://astropy.org">Astropy</a></p>
</nav>

      
      <!-- Shamelessly copied from minimal mistakes -->


<!-- TOC will only show up if it has at least one item -->


  <aside class="sidebar__right">
    <nav class="onthispage">
      <header><h4 class="nav__title"><i class="fa fa-list"></i>   On this page</h4></header>
      <ul class="toc__menu">
  <li><a href="#example-1-with-overscan-subtraction">Example 1: With overscan subtraction</a>
    <ul>
      <li><a href="#data-for-this-example">Data for this example</a></li>
      <li><a href="#make-an-image-file-collection-for-the-raw-data">Make an image file collection for the raw data</a></li>
      <li><a href="#determine-overscan-region">Determine overscan region</a></li>
      <li><a href="#fits-vs-python-indexing">FITS vs Python indexing</a></li>
      <li><a href="#subtract-and-then-trim-the-overscan-one-sample-image">Subtract and then trim the overscan (one sample image)</a></li>
      <li><a href="#discussion">Discussion</a></li>
      <li><a href="#processing-a-folder-of-bias-images">Processing a folder of bias images</a></li>
    </ul>
  </li>
  <li><a href="#example-2-no-overscan-subtraction-but-trim-the-images">Example 2: No overscan subtraction, but trim the images</a>
    <ul>
      <li><a href="#data-for-this-example-1">Data for this example</a></li>
      <li><a href="#determine-overscan-region-1">Determine overscan region</a></li>
      <li><a href="#trim-the-overscan-one-sample-image">Trim the overscan (one sample image)</a></li>
      <li><a href="#processing-a-folder-of-bias-images-1">Processing a folder of bias images</a></li>
    </ul>
  </li>
  <li><a href="#example-3-no-overscan-at-all">Example 3: No overscan at all</a></li>
</ul>
    </nav>
  </aside>


      
      <main class="c-textbook__page" tabindex="-1">
          <div class="o-wrapper">
            <div class="c-sidebar-toggle">
  <!-- We show the sidebar by default so we use .is-active -->
  <button
    id="js-sidebar-toggle"
    class="hamburger hamburger--arrowalt is-active"
  >
    <span class="hamburger-box">
      <span class="hamburger-inner"></span>
    </span>
    <span class="c-sidebar-toggle__label">Toggle Sidebar</span>
  </button>
</div>

            
<div class="buttons">
<a href="/content/02-01-Calibrating-bias-images.ipynb" download>
<button id="interact-button-download" class="interact-button">Download</button>
</a>





</div>


            <div class="c-textbook__content">
              <h1 id="calibrating-bias-images">Calibrating bias images</h1>

<p>The purpose of calibrating bias images is three-fold:</p>

<ul>
  <li>Subtract overscan if you have decided your science will be better if you subtract overscan. See <a href="01.08-Overscan.ipynb">this discussion of overscan</a> for some guidance.</li>
  <li>Trim the overscan region off of the image if it is present, regardless of whether you have chosen to subtract the overscan.</li>
  <li>Combine the bias images into a “combined” bias to be used in calibrating the rest of the images. The purpose of combining several images is to reduce as much as possible the read noise in the combined bias.</li>
</ul>

<p>The approach in this notebook will be to reduce a single image, look at the effects the reduction step had on that image and then demonstrate how to calibrate a folder containing several images of that type.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">CCDData</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">hist</span>
<span class="kn">import</span> <span class="nn">ccdproc</span> <span class="k">as</span> <span class="n">ccdp</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="kn">from</span> <span class="nn">convenience_functions</span> <span class="kn">import</span> <span class="n">show_image</span>
</code></pre></div></div>

<h2 id="example-1-with-overscan-subtraction">Example 1: With overscan subtraction</h2>

<p>### Decide where to put your calibrated images</p>

<p>Though it is possible to overwrite your raw data with calibrated images that is a bad idea. Here we create a folder called <code class="highlighter-rouge">example1-reduced</code> that will contain the calibrated data and create it if it doesn’t exist.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calibrated_data</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="s">'example1-reduced'</span><span class="p">)</span>
<span class="n">calibrated_data</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="data-for-this-example">Data for this example</h3>

<p>The data for this example can be downloaded from <a href="http://www.stsci.edu/~etollerud/python_imred_data.tar">http://www.stsci.edu/~etollerud/python_imred_data.tar</a></p>

<p>In what follows, the unpacked data is presumed to be available in the same direction as this notebook.</p>

<h3 id="make-an-image-file-collection-for-the-raw-data">Make an image file collection for the raw data</h3>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">files</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">ImageFileCollection</span><span class="p">(</span><span class="s">'python_imred_data'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">files</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s">'file'</span><span class="p">,</span> <span class="s">'imagetyp'</span><span class="p">,</span> <span class="s">'filter'</span><span class="p">,</span> <span class="s">'exptime'</span><span class="p">,</span> <span class="s">'naxis1'</span><span class="p">,</span> <span class="s">'naxis2'</span><span class="p">]</span>
</code></pre></div></div>

<div class="output output_html">
<i>Table masked=True length=14</i>
<table id="table47838183552" class="table-striped table-bordered table-condensed">
<thead><tr><th>file</th><th>imagetyp</th><th>filter</th><th>exptime</th><th>naxis1</th><th>naxis2</th></tr></thead>
<thead><tr><th>str17</th><th>str9</th><th>str2</th><th>float64</th><th>int64</th><th>int64</th></tr></thead>
<tr><td>ccd.001.0.fits.gz</td><td>BIAS</td><td>i&apos;</td><td>0.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.002.0.fits.gz</td><td>BIAS</td><td>i&apos;</td><td>0.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.003.0.fits.gz</td><td>BIAS</td><td>i&apos;</td><td>0.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.004.0.fits.gz</td><td>BIAS</td><td>i&apos;</td><td>0.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.005.0.fits.gz</td><td>BIAS</td><td>i&apos;</td><td>0.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.006.0.fits.gz</td><td>BIAS</td><td>i&apos;</td><td>0.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.014.0.fits.gz</td><td>FLATFIELD</td><td>g&apos;</td><td>70.001</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.015.0.fits.gz</td><td>FLATFIELD</td><td>g&apos;</td><td>70.011</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.016.0.fits.gz</td><td>FLATFIELD</td><td>g&apos;</td><td>70.001</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.017.0.fits.gz</td><td>FLATFIELD</td><td>i&apos;</td><td>7.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.018.0.fits.gz</td><td>FLATFIELD</td><td>i&apos;</td><td>7.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.019.0.fits.gz</td><td>FLATFIELD</td><td>i&apos;</td><td>7.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.037.0.fits.gz</td><td>OBJECT</td><td>g&apos;</td><td>300.062</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.043.0.fits.gz</td><td>OBJECT</td><td>i&apos;</td><td>300.014</td><td>2080</td><td>4128</td></tr>
</table>
</div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">darks_only</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">ImageFileCollection</span><span class="p">(</span><span class="s">'python_imred_data/darks/'</span><span class="p">)</span>
<span class="n">darks_only</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s">'file'</span><span class="p">,</span> <span class="s">'imagetyp'</span><span class="p">,</span> <span class="s">'exptime'</span><span class="p">]</span>
</code></pre></div></div>

<div class="output output_html">
<i>Table masked=True length=10</i>
<table id="table47838186576" class="table-striped table-bordered table-condensed">
<thead><tr><th>file</th><th>imagetyp</th><th>exptime</th></tr></thead>
<thead><tr><th>str17</th><th>str4</th><th>float64</th></tr></thead>
<tr><td>ccd.002.0.fits.gz</td><td>BIAS</td><td>0.0</td></tr>
<tr><td>ccd.013.0.fits.gz</td><td>DARK</td><td>300.0</td></tr>
<tr><td>ccd.014.0.fits.gz</td><td>DARK</td><td>300.0</td></tr>
<tr><td>ccd.015.0.fits.gz</td><td>DARK</td><td>300.0</td></tr>
<tr><td>ccd.017.0.fits.gz</td><td>DARK</td><td>70.0</td></tr>
<tr><td>ccd.018.0.fits.gz</td><td>DARK</td><td>70.0</td></tr>
<tr><td>ccd.019.0.fits.gz</td><td>DARK</td><td>70.0</td></tr>
<tr><td>ccd.023.0.fits.gz</td><td>DARK</td><td>7.0</td></tr>
<tr><td>ccd.024.0.fits.gz</td><td>DARK</td><td>7.0</td></tr>
<tr><td>ccd.025.0.fits.gz</td><td>DARK</td><td>7.0</td></tr>
</table>
</div>

<h3 id="determine-overscan-region">Determine overscan region</h3>

<p>Please see the discussion of this camera in <a href="01.08-Overscan.ipynb#Case-1:-Cryogenically-cooled-Large-Format-Camera-(LFC)-at-Palomar">the overscan notebook</a> for the appropriate overscan regioin to use for this camera. Note, in particular, that it differs from the the value given in the <code class="highlighter-rouge">BIASSEC</code> keyword in the header of the images.</p>

<p>The astropy affiliated package <a href="https://ccdproc.readthedocs.io">ccdproc</a> provides two useful functions here:</p>

<ul>
  <li><code class="highlighter-rouge">subtract_overscan</code> for subtracting the overscan from the image, and</li>
  <li><code class="highlighter-rouge">trim_image</code> for trimming off the overscan.</li>
</ul>

<p>First, let’s see what the values of <code class="highlighter-rouge">BIASSEC</code> which sometimes (but not always) indicates that there is is overscan and which part of the chip is the overscan, and <code class="highlighter-rouge">CCDSEC</code>, which is sometimes, but not always present, and indicates which part of the chip light hit.</p>

<p>Note that neither of these are standard; sometimes, for example, <code class="highlighter-rouge">trimsec</code> is used instead of <code class="highlighter-rouge">ccdsec</code>, and there are likely other variants. Some images may have neither keyword in the header. That does not necessary indicate that ovserscan isn’t present. The best advice is to carefully check the documentation for the camer you are using.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">files</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s">'file'</span><span class="p">,</span> <span class="s">'imagetyp'</span><span class="p">,</span> <span class="s">'biassec'</span><span class="p">,</span> <span class="s">'ccdsec'</span><span class="p">,</span> <span class="s">'datasec'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<div class="output output_html">
<i>Row index=0 masked=True</i>
<table id="table47838355352">
<thead><tr><th>file</th><th>imagetyp</th><th>biassec</th><th>ccdsec</th><th>datasec</th></tr></thead>
<thead><tr><th>str17</th><th>str9</th><th>str18</th><th>str15</th><th>str15</th></tr></thead>
<tr><td>ccd.001.0.fits.gz</td><td>BIAS</td><td>[2049:2080,1:4127]</td><td>[1:2048,1:4128]</td><td>[1:2048,1:4128]</td></tr>
</table>
</div>

<p>The fits header claims the overscan extends from the 2049th column to the end of the image (this is one-based indexing) and that the part of the image exposed to light extends over all rows and from the first column to the 2048$^{th}$ column (again, this is one-indexed).</p>

<h3 id="fits-vs-python-indexing">FITS <em>vs</em> Python indexing</h3>

<p>There are two differences between FITS and Python in terms of indexing:</p>

<ul>
  <li>Python indexes are zero-based (i.e. numbering starts at zero), FITS indexes are one-based (i.e. numbering starts at 1).</li>
  <li>The <em>order</em> of the indexes is swapped.</li>
</ul>

<p>For example, the <strong>FITS</strong> representation of the part of the chip exposed to light is <code class="highlighter-rouge">[1:2048,1:4128]</code>. To access that part of the data from a numpy array in <strong>Python</strong>, switch the order so that the indexing looks like this: <code class="highlighter-rouge">[0:4128, 0:2048]</code> (or, more compactly <code class="highlighter-rouge">[:, :2048]</code>). Note that the <em>ending</em> indexes given here for python are correct because the second part of a range (after the colon) is <em>not included</em> in the array slice. For example, <code class="highlighter-rouge">0:2048</code> starts at 0 (the first pixel) and goes up to but not including 2048, so the last pixel included is <code class="highlighter-rouge">2047</code> (the 2048$^{th}$ pixel).</p>

<p>As discussed in <a href="01.08-Overscan.ipynb#Case-1:-Cryogenically-cooled-Large-Format-Camera-(LFC)-at-Palomar">the overscan notebook</a>, the useful overscan region for this camera starts at the 2055$^{th}$ column, not column 2049 as indicated by the <code class="highlighter-rouge">BIASSEC</code> keyword in the header. This situation is not unusual; column 2049 is the first of the columns masked by the manufacturer from light but there is some leakage into this region from the rest of the CCD.</p>

<p>If you are going to overscan you need to carefully emaine the overscan in a few representative images to understand which part of the overscan to use.</p>

<p>In what follow, we will use for the overscan the region (Python/numpy indexing) <code class="highlighter-rouge">[:, 2055:]</code>.</p>

<h3 id="subtract-and-then-trim-the-overscan-one-sample-image">Subtract and then trim the overscan (one sample image)</h3>

<p>Using <code class="highlighter-rouge">subtract_overscan</code> is reasonably straightforward, as shown in the cell below.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">raw_biases</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">files_filtered</span><span class="p">(</span><span class="n">include_path</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">imagetyp</span><span class="o">=</span><span class="s">'BIAS'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">first_bias</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">raw_biases</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s">'adu'</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bias_overscan_subtracted</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">subtract_overscan</span><span class="p">(</span><span class="n">first_bias</span><span class="p">,</span> <span class="n">overscan</span><span class="o">=</span><span class="n">first_bias</span><span class="p">[:,</span> <span class="mi">2055</span><span class="p">:],</span> <span class="n">median</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>Next, we trim off the full overscan region (not just the part we used for subtracting overscan)</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trimmed_bias</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">bias_overscan_subtracted</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2048</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">show_image</span><span class="p">(</span><span class="n">first_bias</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'gray'</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Raw bias'</span><span class="p">)</span>
<span class="n">show_image</span><span class="p">(</span><span class="n">trimmed_bias</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'gray'</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Bias, overscan subtracted and trimmed'</span><span class="p">)</span>
</code></pre></div></div>

<div class="output output_data_text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Text(0.5, 1.0, 'Bias, overscan subtracted and trimmed')
</code></pre></div></div>

<p class="output output_png"><img src="images/02-01-Calibrating-bias-images_24_1.png" alt="png" /></p>

<h3 id="discussion">Discussion</h3>

<p>Visually, the images look nearly identical before and after calibration. The only prominent difference is a shift in the pixel values, as one would expect from subtracting the same value from each pixel in an image. It simply shifts the zero point.</p>

<p>There is ones other important difference between the images: the input image uses 32MB of memory while the calibrated, overscan-subtracted image uses roughly 128MB. The input image is stored as unsigned 16-bit integers; the calibrated image is stored as floating point numbers, which default in python to 64-bit floats. The memory size is also the size the files will have when written to disk (ignoring any compression). One can reduce the memory and disk footprint by changing the <code class="highlighter-rouge">dtype</code> of the image: <code class="highlighter-rouge">trimmed_bias.dtype = 'float32'</code>. It is best to do this just before writing the image out because arithmetic operations on the image may convert its dtype back to <code class="highlighter-rouge">float64</code>.</p>

<h3 id="processing-a-folder-of-bias-images">Processing a folder of bias images</h3>

<p>Processing each of the bias images individually would be tedious, at best. Instead, we can use the <a href="https://ccdproc.readthedocs.io/en/latest/ccdproc/image_management.html"><code class="highlighter-rouge">ImageFileCollection</code></a> we created above to loop over only the bias images, saving each in the folder <code class="highlighter-rouge">calibrated_data</code>. In this example the files are saved uncompressed because the Python library for compressing gzip files is extremely slow.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">ccd</span><span class="p">,</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">ccds</span><span class="p">(</span><span class="n">imagetyp</span><span class="o">=</span><span class="s">'BIAS'</span><span class="p">,</span>            <span class="c"># Just get the bias frames</span>
                                 <span class="n">ccd_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'unit'</span><span class="p">:</span> <span class="s">'adu'</span><span class="p">},</span> <span class="c"># CCDData requires a unit for the image if </span>
                                                             <span class="c"># it is not in the header</span>
                                 <span class="n">return_fname</span><span class="o">=</span><span class="bp">True</span>           <span class="c"># Provide the file name too.</span>
                                <span class="p">):</span>
    <span class="n">save_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.gz'</span><span class="p">)</span>
    
    <span class="c"># Subtract the overscan</span>
    <span class="n">ccd</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">subtract_overscan</span><span class="p">(</span><span class="n">ccd</span><span class="p">,</span> <span class="n">overscan</span><span class="o">=</span><span class="n">ccd</span><span class="p">[:,</span> <span class="mi">2055</span><span class="p">:],</span> <span class="n">median</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c"># Trim the overscan</span>
    <span class="n">ccd</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">ccd</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2048</span><span class="p">])</span>
    
    <span class="c"># Save the result</span>
    <span class="n">ccd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">calibrated_data</span> <span class="o">/</span> <span class="n">save_name</span><span class="p">)</span>
</code></pre></div></div>

<p>Let’s check that we really did get the images we expect by creating an <a href="https://ccdproc.readthedocs.io/en/latest/ccdproc/image_management.html"><code class="highlighter-rouge">ImageFileCollection</code></a> for the reduced folder and displaying the size of each image. We are expecting the images to be 2048 × 4128, and that there will be the same number of reduced bias images as input bias images (six).</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">reduced_images</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">ImageFileCollection</span><span class="p">(</span><span class="n">calibrated_data</span><span class="p">)</span>
<span class="n">reduced_images</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s">'file'</span><span class="p">,</span> <span class="s">'imagetyp'</span><span class="p">,</span> <span class="s">'naxis1'</span><span class="p">,</span> <span class="s">'naxis2'</span><span class="p">]</span>
</code></pre></div></div>

<div class="output output_html">
<i>Table masked=True length=6</i>
<table id="table121090192496" class="table-striped table-bordered table-condensed">
<thead><tr><th>file</th><th>imagetyp</th><th>naxis1</th><th>naxis2</th></tr></thead>
<thead><tr><th>str14</th><th>str4</th><th>int64</th><th>int64</th></tr></thead>
<tr><td>ccd.001.0.fits</td><td>BIAS</td><td>2048</td><td>4128</td></tr>
<tr><td>ccd.002.0.fits</td><td>BIAS</td><td>2048</td><td>4128</td></tr>
<tr><td>ccd.003.0.fits</td><td>BIAS</td><td>2048</td><td>4128</td></tr>
<tr><td>ccd.004.0.fits</td><td>BIAS</td><td>2048</td><td>4128</td></tr>
<tr><td>ccd.005.0.fits</td><td>BIAS</td><td>2048</td><td>4128</td></tr>
<tr><td>ccd.006.0.fits</td><td>BIAS</td><td>2048</td><td>4128</td></tr>
</table>
</div>

<h2 id="example-2-no-overscan-subtraction-but-trim-the-images">Example 2: No overscan subtraction, but trim the images</h2>

<p>If you are not subtracting overscan then the only manipulation you may need to do is trimming the overscan from the images. If there is no overscan region in your images then even that is unnecessary.</p>

<p>### Decide where to put your calibrated images</p>

<p>Though it is possible to overwrite your raw data with calibrated images that is a bad idea. Here we create a folder called <code class="highlighter-rouge">example2-reduced</code> that will contain the calibrated data and create it if it doesn’t exist.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calibrated_data</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="s">'example2-reduced'</span><span class="p">)</span>
<span class="n">calibrated_data</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="data-for-this-example-1">Data for this example</h3>

<p>The data for this example can be downloaded from XXXX</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">files</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">ImageFileCollection</span><span class="p">(</span><span class="s">'example-thermo-electric'</span><span class="p">)</span>
<span class="n">files</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s">'file'</span><span class="p">,</span> <span class="s">'imagetyp'</span><span class="p">,</span> <span class="s">'filter'</span><span class="p">,</span> <span class="s">'exptime'</span><span class="p">,</span> <span class="s">'naxis1'</span><span class="p">,</span> <span class="s">'naxis2'</span><span class="p">]</span>
</code></pre></div></div>

<div class="output output_html">
<i>Table masked=True length=32</i>
<table id="table47865841312" class="table-striped table-bordered table-condensed">
<thead><tr><th>file</th><th>imagetyp</th><th>filter</th><th>exptime</th><th>naxis1</th><th>naxis2</th></tr></thead>
<thead><tr><th>str34</th><th>str5</th><th>object</th><th>float64</th><th>int64</th><th>int64</th></tr></thead>
<tr><td>AutoFlat-PANoRot-r-Bin1-001.fit.gz</td><td>FLAT</td><td>r</td><td>1.0</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-002.fit.gz</td><td>FLAT</td><td>r</td><td>1.0</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-003.fit.gz</td><td>FLAT</td><td>r</td><td>1.0</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-004.fit.gz</td><td>FLAT</td><td>r</td><td>1.0</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-005.fit.gz</td><td>FLAT</td><td>r</td><td>1.0</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-006.fit.gz</td><td>FLAT</td><td>r</td><td>1.02</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-007.fit.gz</td><td>FLAT</td><td>r</td><td>1.06</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-008.fit.gz</td><td>FLAT</td><td>r</td><td>1.11</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-009.fit.gz</td><td>FLAT</td><td>r</td><td>1.16</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-010.fit.gz</td><td>FLAT</td><td>r</td><td>1.21</td><td>4109</td><td>4096</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>Dark-S001-R001-C003-NoFilt.fit.gz</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C004-NoFilt.fit.gz</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C005-NoFilt.fit.gz</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C006-NoFilt.fit.gz</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C007-NoFilt.fit.gz</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C008-NoFilt.fit.gz</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C009-NoFilt.fit.gz</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C020-NoFilt.fit.gz</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>kelt-16-b-S001-R001-C084-r.fit.gz</td><td>LIGHT</td><td>r</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>kelt-16-b-S001-R001-C125-r.fit.gz</td><td>LIGHT</td><td>r</td><td>90.0</td><td>4109</td><td>4096</td></tr>
</table>
</div>

<h3 id="determine-overscan-region-1">Determine overscan region</h3>

<p>Please see the discussion of this camera in <a href="01.08-Overscan.ipynb#Case-2:-Thermo-electrically-cooled-Apogee-Aspen-CG16M">the overscan notebook</a> for a discussion of the overscan region of this camera. The overscan for this camera is not useful but should be trimmed out at this stage.</p>

<p>These headers have some information in the keywords <code class="highlighter-rouge">BIASSEC</code> and <code class="highlighter-rouge">TRIMSEC</code> indicating, in the FITS numbering convention, the overscan region and the science region of the chip.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">files</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s">'file'</span><span class="p">,</span> <span class="s">'imagetyp'</span><span class="p">,</span> <span class="s">'biassec'</span><span class="p">,</span> <span class="s">'trimsec'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<div class="output output_html">
<i>Row index=0 masked=True</i>
<table id="table47867060464">
<thead><tr><th>file</th><th>imagetyp</th><th>biassec</th><th>trimsec</th></tr></thead>
<thead><tr><th>str34</th><th>str5</th><th>str11</th><th>str11</th></tr></thead>
<tr><td>AutoFlat-PANoRot-r-Bin1-001.fit.gz</td><td>FLAT</td><td>[4096:4109]</td><td>[1:4096, :]</td></tr>
</table>
</div>

<p>Based on this, and the decision not to subtract overscan for this camera, we will only need to trim the overscan region off of the images. See the discussion at <a href="#FITS-vs-Python-indexing">FITS <em>vs</em> Python indexing</a>, above, for some details about the difference between FITS and Python indexing. Essentially, to get Python indexes from FITS, reverse the order and subtract one.</p>

<h3 id="trim-the-overscan-one-sample-image">Trim the overscan (one sample image)</h3>

<p>The function <code class="highlighter-rouge">trim_image</code> from <a href="ccdproc.rtfd.io">ccdproc</a> removes a portion of the image and updates the image metadata as needed.</p>

<p>Below we get the first bias image.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">raw_biases</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">files_filtered</span><span class="p">(</span><span class="n">include_path</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">imagetyp</span><span class="o">=</span><span class="s">'BIAS'</span><span class="p">)</span>

<span class="n">first_bias</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">raw_biases</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s">'adu'</span><span class="p">)</span>
</code></pre></div></div>

<div class="output output_stream highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]

</code></pre></div></div>

<p>There two ways of specifying the region to trim. One is to slice the image in Python; the other is to use the <code class="highlighter-rouge">fits_section</code> argument to <code class="highlighter-rouge">trim_image</code>.</p>

<p>The cell below uses a FITS-style section.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trimmed_bias_fits</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">first_bias</span><span class="p">,</span> <span class="n">fits_section</span><span class="o">=</span><span class="s">'[1:4096, :]'</span><span class="p">)</span>
</code></pre></div></div>

<p>The cell below does the same trimming as the one above, but with Python-style slicing.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trimmed_bias_python</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">first_bias</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4096</span><span class="p">])</span>
</code></pre></div></div>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">trimmed_bias_python</span><span class="p">,</span> <span class="n">trimmed_bias_fits</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="processing-a-folder-of-bias-images-1">Processing a folder of bias images</h3>

<p>As in <a href="#Example-1:-With-overscan-subtraction">Example 1</a>, above, we can use the <a href="https://ccdproc.readthedocs.io/en/latest/ccdproc/image_management.html"><code class="highlighter-rouge">ImageFileCollection</code></a> we created  to loop over only the bias images, saving each in the folder <code class="highlighter-rouge">calibrated_data</code>.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">ccd</span><span class="p">,</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">ccds</span><span class="p">(</span><span class="n">imagetyp</span><span class="o">=</span><span class="s">'BIAS'</span><span class="p">,</span>            <span class="c"># Just get the bias frames</span>
                                 <span class="n">return_fname</span><span class="o">=</span><span class="bp">True</span>           <span class="c"># Provide the file name too.</span>
                                <span class="p">):</span>
    <span class="n">save_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.gz'</span><span class="p">)</span>
    
    <span class="c"># Trim the overscan</span>
    <span class="n">ccd</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">ccd</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4096</span><span class="p">])</span>
    
    <span class="c"># Save the result</span>
    <span class="n">ccd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">calibrated_data</span> <span class="o">/</span> <span class="n">save_name</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="example-3-no-overscan-at-all">Example 3: No overscan at all</h2>

<p>If there is no overscan then there is, in principle, nothing to be done with the bias frames. It may be convient to copy them to the directory with the rest of your reduced images. The code below does that.</p>

<div class="language-python input_area highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calibrated_data</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="s">'example3-reduced'</span><span class="p">)</span>
<span class="n">calibrated_data</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">biases</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">files_filtered</span><span class="p">(</span><span class="n">imagetyp</span><span class="o">=</span><span class="s">'BIAS'</span><span class="p">,</span> <span class="n">include_path</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">for</span> <span class="n">bias</span> <span class="ow">in</span> <span class="n">biases</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">bias</span><span class="p">,</span> <span class="n">calibrated_data</span><span class="p">)</span>
</code></pre></div></div>


              <nav class="c-page__nav">
  
    
    <a id="js-page__nav__prev" class="c-page__nav__prev" href="/02-00-Handling-overscan-trimming-and-bias-subtraction">
      〈 <span class="u-margin-right-tiny"></span> Overscan and bias images
    </a>
  

  
    
    <a id="js-page__nav__next" class="c-page__nav__next" href="/02-04-Combine-bias-images-to-make-master">
      Combinge bias images to make maste... <span class="u-margin-right-tiny"></span> 〉
    </a>
  
</nav>

            </div>
          </div>
        </div>
      </main>
    </div>

  </body>
</html>
